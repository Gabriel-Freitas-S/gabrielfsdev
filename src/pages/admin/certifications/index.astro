---
import AdminLayout from "../../../layouts/AdminLayout.astro";

const { env } = Astro.locals.runtime;
const { results } = await env.DB.prepare(
    "SELECT * FROM certifications ORDER BY date DESC",
).run();
---

<AdminLayout title="Certificações">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Certificações</h1>
        <a
            href="/admin/certifications/new"
            class="bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded font-bold transition"
        >
            + Nova Certificação
        </a>
    </div>

    <div class="space-y-4">
        {
            results.map((cert: any) => (
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold text-white">
                            {cert.title}
                        </h3>
                        <div class="flex gap-2 text-sm text-slate-400 mt-1">
                            <span>{cert.issuer}</span>
                            <span>•</span>
                            <span>{cert.hours}h</span>
                            {cert.group_name && (
                                <>
                                    <span>•</span>
                                    <span class="text-purple-400">
                                        {cert.group_name}
                                    </span>
                                </>
                            )}
                        </div>
                        {cert.url && (
                            <a
                                href={cert.url}
                                target="_blank"
                                class="text-xs text-blue-400 hover:underline"
                            >
                                Credencial ↗
                            </a>
                        )}
                    </div>
                    <div class="flex gap-3">
                        <a
                            href={`/admin/certifications/${cert.id}`}
                            class="text-blue-400 hover:text-blue-300"
                        >
                            Editar
                        </a>
                        <form
                            method="POST"
                            action={`/admin/certifications/delete?id=${cert.id}`}
                            onsubmit="return confirm('Tem certeza?');"
                        >
                            <button class="text-red-400 hover:text-red-300">
                                Excluir
                            </button>
                        </form>
                    </div>
                </div>
            ))
        }
    </div>
</AdminLayout>
