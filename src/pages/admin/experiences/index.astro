---
import AdminLayout from "../../../layouts/AdminLayout.astro";

const { env } = Astro.locals.runtime;
const { results } = await env.DB.prepare(
    "SELECT * FROM experiences ORDER BY start_date DESC",
).run();
---

<AdminLayout title="Experiências">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Experiências</h1>
        <a
            href="/admin/experiences/new"
            class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded font-bold transition"
        >
            + Nova Experiência
        </a>
    </div>

    <div class="space-y-4">
        {
            results.map((xp: any) => (
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 flex justify-between items-start">
                    <div>
                        <h3 class="text-xl font-bold text-white">{xp.role}</h3>
                        <p class="text-slate-400 font-medium">{xp.company}</p>
                        <p class="text-sm text-slate-500 mt-1">
                            {xp.start_date} - {xp.end_date || "Presente"}
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <a
                            href={`/admin/experiences/${xp.id}`}
                            class="text-blue-400 hover:text-blue-300"
                        >
                            Editar
                        </a>
                        <form
                            method="POST"
                            action={`/admin/experiences/delete?id=${xp.id}`}
                            onsubmit="return confirm('Tem certeza?');"
                        >
                            <button class="text-red-400 hover:text-red-300">
                                Excluir
                            </button>
                        </form>
                    </div>
                </div>
            ))
        }

        {
            results.length === 0 && (
                <p class="text-slate-500 text-center py-10">
                    Nenhuma experiência cadastrada.
                </p>
            )
        }
    </div>
</AdminLayout>
